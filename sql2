SELECT 
    table_schema || '.' || table_name AS table_full_name,
    pg_size_pretty(pg_total_relation_size(quote_ident(table_schema) || '.' || quote_ident(table_name))) AS total_size,
    pg_size_pretty(pg_relation_size(quote_ident(table_schema) || '.' || quote_ident(table_name))) AS table_size,
    pg_size_pretty(pg_total_relation_size(quote_ident(table_schema) || '.' || quote_ident(table_name)) - pg_relation_size(quote_ident(table_schema) || '.' || quote_ident(table_name))) AS index_size,
    (SELECT COUNT(*) 
     FROM information_schema.columns 
     WHERE table_schema = t.table_schema 
     AND table_name = t.table_name) AS column_count,
    (SELECT reltuples::BIGINT 
     FROM pg_class c
     JOIN pg_namespace n ON c.relnamespace = n.oid
     WHERE c.relname = t.table_name 
     AND n.nspname = t.table_schema) AS row_count
FROM 
    information_schema.tables t
WHERE 
    t.table_type = 'BASE TABLE'  -- 只统计普通表
    AND t.table_schema NOT IN ('pg_catalog', 'information_schema', 'pg_toast', 'pg_temp_1')  -- 排除系统模式和临时表
    AND t.table_schema NOT LIKE 'pg_%'  -- 排除其他以pg_开头的模式
    AND t.table_schema NOT LIKE 'information_schema'  -- 排除信息架构
ORDER BY 
    pg_total_relation_size(quote_ident(table_schema) || '.' || quote_ident(table_name)) DESC;








SELECT 
    table_schema || '.' || table_name AS table_full_name,
    pg_size_pretty(pg_total_relation_size('"' || table_schema || '"."' || table_name || '"')) AS table_size,
    (SELECT count(*) FROM information_schema.columns 
     WHERE table_schema = t.table_schema 
     AND table_name = t.table_name) AS column_count,
    (SELECT count(*) FROM information_schema.tables
     WHERE table_schema = t.table_schema
     AND table_type = 'BASE TABLE') AS row_count
FROM 
    information_schema.tables t
WHERE 
    t.table_schema NOT IN ('pg_catalog', 'information_schema')
    AND t.table_type = 'BASE TABLE';
